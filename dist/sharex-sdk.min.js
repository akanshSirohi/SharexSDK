!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("sharex-sdk",[],e):"object"==typeof exports?exports["sharex-sdk"]=e():t["sharex-sdk"]=e()}(self,(()=>(()=>{var t={853:t=>{function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e(t)}t.exports={extractPluginUID:function(t){var e=t.match(/\/SharexApp\/([\w-]+)(?:\/[^/]+)*\/?/i);return e?e[1]:""},convertToDotNotation:function t(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=[];for(var i in n)if(n.hasOwnProperty(i)){var a=r?"".concat(r,".").concat(i):i;"object"===e(n[i])&&null!==n[i]?o=o.concat(t(n[i],a)):o.push("".concat(a,":").concat(n[i]))}return o}}}},e={};function n(r){var o=e[r];if(void 0!==o)return o.exports;var i=e[r]={exports:{}};return t[r](i,i.exports,n),i.exports}n.d=(t,e)=>{for(var r in e)n.o(e,r)&&!n.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var r={};return(()=>{"use strict";n.r(r),n.d(r,{default:()=>y});const t={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let e;const o=new Uint8Array(16);function i(){if(!e&&(e="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!e))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return e(o)}const a=[];for(let t=0;t<256;++t)a.push((t+256).toString(16).slice(1));const s=function(e,n,r){if(t.randomUUID&&!n&&!e)return t.randomUUID();const o=(e=e||{}).random||(e.rng||i)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,n){r=r||0;for(let t=0;t<16;++t)n[r+t]=o[t];return n}return function(t,e=0){return a[t[e+0]]+a[t[e+1]]+a[t[e+2]]+a[t[e+3]]+"-"+a[t[e+4]]+a[t[e+5]]+"-"+a[t[e+6]]+a[t[e+7]]+"-"+a[t[e+8]]+a[t[e+9]]+"-"+a[t[e+10]]+a[t[e+11]]+a[t[e+12]]+a[t[e+13]]+a[t[e+14]]+a[t[e+15]]}(o)},c=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;var l=n(853);function u(t){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},u(t)}function b(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,d(r.key),r)}}function d(t){var e=function(t,e){if("object"!=u(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=u(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==u(e)?e:String(e)}const _=function(){function t(e,n,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.db_name=e,this.websocket=n,this.db_callbacks=r,this.insert_data_callback=null,this.get_data_callback=null,this.update_data_callback=null,this.delete_data_callback=null,Object.defineProperty(this,"DBActions",{value:{INIT_DB:"init_user"},writable:!1}),this.websocket.send(JSON.stringify({action:"db_action_init_db",data:{db_name:this.db_name}})),Object.defineProperty(this,"dbActions",{value:{INIT_DB:"init_db",INIT_DB_RESULT:"init_db_result",INSERT_DATA:"insert_data",INSERT_DATA_BULK:"insert_data_bulk",INSERT_DATA_RESULT:"insert_data_result",GET_ALL_DATA:"get_all_data",GET_ALL_DATA_RESULT:"get_all_data_result",GET_DATA:"get_data",GET_DATA_RESULT:"get_data_result",UPDATE_DATA:"update_data",UPDATE_DATA_RESULT:"update_data_result",DELETE_DATA:"delete_data",DELETE_DATA_RESULT:"delete_data_result"},writable:!1})}var e,n;return e=t,n=[{key:"updateInternalWebsocket",value:function(t){this.websocket=t}},{key:"websocket_handleDBAction",value:function(t){if(t.action=t.action.replace("db_action_",""),t.action==this.dbActions.INIT_DB_RESULT)this.db_callbacks(t.action,t.data);else if(t.action==this.dbActions.INSERT_DATA_RESULT)null!=this.insert_data_callback&&this.insert_data_callback(JSON.parse(t.data));else if(t.action==this.dbActions.GET_ALL_DATA_RESULT||t.action==this.dbActions.GET_DATA_RESULT){if(null!=this.get_data_callback)if(t.action==this.dbActions.GET_DATA_RESULT){var e=JSON.parse(t.data);this.get_data_callback({status:e.status,data:JSON.parse(e.data)})}else this.get_data_callback(JSON.parse(t.data))}else t.action==this.dbActions.UPDATE_DATA_RESULT?null!=this.update_data_callback&&this.update_data_callback(JSON.parse(t.data)):t.action==this.dbActions.DELETE_DATA_RESULT&&null!=this.delete_data_callback&&this.delete_data_callback(JSON.parse(t.data))}},{key:"insert",value:function(t,e){var n,r,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=Array.isArray(e);if(!a&&"object"!==u(e)||a&&!Array.isArray(e))throw new Error(a?"data must be an array of objects":"data must be an object");if("string"!=typeof t)throw new Error("collection must be a string");if("function"==typeof o&&(i=o,o=null),null!==o&&"object"!==u(o))throw new Error("options must be an object");if(!0===(null===(n=o)||void 0===n?void 0:n.uuid))a?e.forEach((function(t,n){e[n]._uuid=s()})):e._uuid=s();else if(void 0!==(null===(r=o)||void 0===r?void 0:r.uuid))throw new Error("options.uuid must be a boolean");this.insert_data_callback=i;var c="db_action_".concat(a?this.dbActions.INSERT_DATA_BULK:this.dbActions.INSERT_DATA);this.websocket.send(JSON.stringify({action:c,data:{db_name:this.db_name,collection:t,new_data:e}}))}},{key:"find",value:function(t,e,n){if("function"==typeof e&&(n=e,e=null),"function"!=typeof n)throw new Error("callback must be a function");if("string"!=typeof t)throw new Error("collection must be a string");var r=null!==e&&"string"==typeof e;this.get_data_callback=n,r?this.websocket.send(JSON.stringify({action:"db_action_".concat(this.dbActions.GET_DATA),data:{db_name:this.db_name,collection:t,query:e}})):this.websocket.send(JSON.stringify({action:"db_action_".concat(this.dbActions.GET_ALL_DATA),data:{db_name:this.db_name,collection:t}}))}},{key:"updateById",value:function(t,e,n,r){if("function"!=typeof r)throw new Error("callback must be a function");if("string"!=typeof t)throw new Error("collection must be a string");if("string"!=typeof e)throw new Error("uuid must be a string");if("object"!==u(n))throw new Error("document must be an object");this.update(t,"$[?(@._uuid == '".concat(e,"')]"),n,r)}},{key:"update",value:function(t,e,n,r){if("function"!=typeof r)throw new Error("callback must be a function");if("string"!=typeof t)throw new Error("collection must be a string");if("string"!=typeof e)throw new Error("query must be a string");if("object"!==u(n))throw new Error("document must be an object");this.update_data_callback=r;var o=(0,l.convertToDotNotation)(n);console.log("Converted Notation: ",o),this.websocket.send(JSON.stringify({action:"db_action_".concat(this.dbActions.UPDATE_DATA),data:{db_name:this.db_name,collection:t,query:e,update:o}}))}},{key:"deleteById",value:function(t,e,n){if("function"!=typeof n)throw new Error("callback must be a function");if("string"!=typeof t)throw new Error("collection must be a string");if("string"!=typeof e)throw new Error("uuid must be a string");this.delete(t,"$[?(@._uuid == '".concat(e,"')]"),n)}},{key:"delete",value:function(t,e,n){if("function"!=typeof n)throw new Error("callback must be a function");if("string"!=typeof t)throw new Error("collection must be a string");if("string"!=typeof e)throw new Error("query must be a string");this.delete_data_callback=n,this.websocket.send(JSON.stringify({action:"db_action_".concat(this.dbActions.DELETE_DATA),data:{db_name:this.db_name,collection:t,query:e}}))}}],n&&b(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function f(t){return f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},f(t)}function h(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,p(r.key),r)}}function p(t){var e=function(t,e){if("object"!=f(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=f(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==f(e)?e:String(e)}const y=function(){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),"object"!==f(n)||null===n)throw new Error("options must be an object");if(n.hasOwnProperty("preserve_session_id")){if("boolean"!=typeof n.preserve_session_id)throw new Error("preserve_session_id must be a boolean");this.preserve_session_id=n.preserve_session_id}else this.preserve_session_id=!1;if(this.debug=!1,n.hasOwnProperty("debug")){if("object"!==f(n.debug)||null===n.debug)throw new Error("debug must be an object");if(!n.debug.hasOwnProperty("host")||"string"!=typeof n.debug.host||!n.debug.hasOwnProperty("port"))throw new Error("debug must have a property called host and port");Object.defineProperty(this,"hostname",{value:n.debug.host,writable:!1}),Object.defineProperty(this,"port",{value:parseInt(n.debug.port),writable:!1}),Object.defineProperty(this,"package_name",{value:"debug",writable:!1}),this.debug=!0}if(this.debug||(Object.defineProperty(this,"hostname",{value:window.location.hostname,writable:!1}),Object.defineProperty(this,"port",{value:parseInt(window.location.port),writable:!1}),Object.defineProperty(this,"package_name",{value:(0,l.extractPluginUID)(window.location.pathname).replaceAll("-","."),writable:!1})),this.preserve_session_id?(localStorage.hasOwnProperty("sharex_sdk_uuid")&&("string"==typeof(e=localStorage.getItem("sharex_sdk_uuid"))&&c.test(e))||localStorage.setItem("sharex_sdk_uuid",s()),Object.defineProperty(this,"uuid",{value:localStorage.getItem("sharex_sdk_uuid"),writable:!1})):Object.defineProperty(this,"uuid",{value:s(),writable:!1}),this.connectionStatus=!1,this.websocket_callbacks=null,this.db_instance=null,this.reconnect_timer=null,this.reconnect_timer_interval=3e3,n.hasOwnProperty("reconnect_interval")){if("number"!=typeof n.reconnect_interval)throw new Error("reconnect_interval must be a number");this.reconnect_timer_interval=n.reconnect_interval}if(n.hasOwnProperty("public_data")){if("object"!==f(n.public_data)||null===n.public_data)throw new Error("public_data must be an object");this.public_data=n.public_data}else this.public_data={};this.init_websocket=!1,Object.defineProperty(this,"serverActions",{value:{INIT_USER:"init_user",UPDATE_USER_DATA:"update_user_data",GET_ALL_USERS:"get_all_users",RETURN_ALL_USERS:"return_all_users",USER_LEFT:"user_left",USER_ARRIVE:"user_arrive",SEND_MSG:"send_msg",MSG_ARRIVE:"msg_arrive",GET_PUBLIC_DATA_OF_USER:"get_public_data_of_user",RETURN_PUBLIC_DATA_OF_USER:"return_public_data_of_user"},writable:!1}),this.returnAllUsers=null,this.returnPublicDataOfUser=null}var e,n;return e=t,n=[{key:"init",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.websocket_callbacks=e,this.websocket=new WebSocket("ws://".concat(this.hostname,":").concat(this.port+1)),this.websocket.addEventListener("open",(function(e){t.connectionStatus=!0,t.websocket.send(JSON.stringify({action:t.serverActions.INIT_USER,package_name:t.package_name,data:{uuid:t.uuid,public_data:t.public_data}})),null!==t.reconnect_timer?(clearTimeout(t.reconnect_timer),t.reconnect_timer=null,null!==t.db_instance&&t.db_instance.updateInternalWebsocket(t.websocket),null!=t.websocket_callbacks&&t.websocket_callbacks("reconnect",e)):null!=t.websocket_callbacks&&t.websocket_callbacks("open",e)})),this.websocket.addEventListener("error",(function(e){null!=t.websocket_callbacks&&t.websocket_callbacks("error",e)})),this.websocket.addEventListener("close",(function(e){t.connectionStatus=!1,t.websocket=null,null!=t.websocket_callbacks&&t.websocket_callbacks("close",e),t.reconnect_timer=setTimeout((function(){t.init(t.websocket_callbacks)}),t.reconnect_timer_interval)})),this.websocket.addEventListener("message",(function(e){var n=e.data;if(n.length>0)switch((n=JSON.parse(n)).action){case t.serverActions.RETURN_ALL_USERS:null!=t.returnAllUsers&&t.returnAllUsers(n.all_users);break;case t.serverActions.USER_ARRIVE:null!=t.websocket_callbacks&&t.websocket_callbacks(t.serverActions.USER_ARRIVE,n.user);break;case t.serverActions.USER_LEFT:null!=t.websocket_callbacks&&t.websocket_callbacks(t.serverActions.USER_LEFT,n);break;case t.serverActions.MSG_ARRIVE:null!=t.websocket_callbacks&&t.websocket_callbacks(t.serverActions.MSG_ARRIVE,n.message);break;case t.serverActions.RETURN_PUBLIC_DATA_OF_USER:null!=t.returnPublicDataOfUser&&t.returnPublicDataOfUser(n.public_data);break;default:n.action.startsWith("db_action_")&&t.db_instance.websocket_handleDBAction(n)}})),this.init_websocket=!0}},{key:"createDBInstance",value:function(t,e){return this.db_instance=new _(t,this.websocket,e),this.db_instance}},{key:"sendMsg",value:function(t,e){if(!this.init_websocket)throw new Error("WebSocket not initialized");this.websocket.send(JSON.stringify({action:this.serverActions.SEND_MSG,data:{uuid:t,msg:e}}))}},{key:"getMyPublicData",value:function(){return this.public_data}},{key:"getMyUUID",value:function(){return this.uuid}},{key:"getAllUsers",value:function(t){if(!this.init_websocket)throw new Error("WebSocket not initialized");this.websocket.send(JSON.stringify({action:this.serverActions.GET_ALL_USERS})),this.returnAllUsers=t}},{key:"requestPublicData",value:function(t,e){if(!this.init_websocket)throw new Error("WebSocket not initialized");this.websocket.send(JSON.stringify({action:this.serverActions.GET_PUBLIC_DATA_OF_USER,data:{uuid:t}})),this.returnPublicDataOfUser=e}},{key:"updateMyPublicData",value:function(t){if("object"!==f(t)||null===t)throw new Error("Public data must be an object");this.public_data=t,this.websocket.send(JSON.stringify({action:this.serverActions.UPDATE_USER,data:{public_data:this.public_data}}))}}],n&&h(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}()})(),r})()));