!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("sharex-sdk",[],e):"object"==typeof exports?exports["sharex-sdk"]=e():t["sharex-sdk"]=e()}(self,(()=>(()=>{var t={853:t=>{t.exports={extractPluginUID:function(t){var e=t.match(/\/SharexApp\/([\w-]+)(?:\/[^/]+)*\/?/i);return e?e[1]:""}}}},e={};function n(r){var i=e[r];if(void 0!==i)return i.exports;var o=e[r]={exports:{}};return t[r](o,o.exports,n),o.exports}n.d=(t,e)=>{for(var r in e)n.o(e,r)&&!n.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var r={};return(()=>{"use strict";n.r(r),n.d(r,{default:()=>y});const t={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let e;const i=new Uint8Array(16);function o(){if(!e&&(e="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!e))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return e(i)}const a=[];for(let t=0;t<256;++t)a.push((t+256).toString(16).slice(1));const s=function(e,n,r){if(t.randomUUID&&!n&&!e)return t.randomUUID();const i=(e=e||{}).random||(e.rng||o)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,n){r=r||0;for(let t=0;t<16;++t)n[r+t]=i[t];return n}return function(t,e=0){return a[t[e+0]]+a[t[e+1]]+a[t[e+2]]+a[t[e+3]]+"-"+a[t[e+4]]+a[t[e+5]]+"-"+a[t[e+6]]+a[t[e+7]]+"-"+a[t[e+8]]+a[t[e+9]]+"-"+a[t[e+10]]+a[t[e+11]]+a[t[e+12]]+a[t[e+13]]+a[t[e+14]]+a[t[e+15]]}(i)};var c=n(853);function u(t){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},u(t)}function l(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,b(r.key),r)}}function b(t){var e=function(t,e){if("object"!=u(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=u(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==u(e)?e:String(e)}const d=function(){function t(e,n,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.db_name=e,this.websocket=n,this.db_callbacks=r,this.insert_data_callback=null,Object.defineProperty(this,"DBActions",{value:{INIT_DB:"init_user"},writable:!1}),this.websocket.send(JSON.stringify({action:"db_action_init_db",data:{db_name:this.db_name}}))}var e,n;return e=t,n=[{key:"websocket_handleDBAction",value:function(t){t.action=t.action.replace("db_action_",""),"init_db_result"==t.action?this.db_callbacks(t.action,t.data):"insert_data_result"==t.action&&null!=this.insert_data_callback&&this.insert_data_callback(t.data)}},{key:"insert",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if("object"!=u(e)||null==e||null==e)throw new Error("Data must be a object");this.insert_data_callback=n,this.websocket.send(JSON.stringify({action:"db_action_insert_data",data:{db_name:this.db_name,collection:t,new_data:e}}))}}],n&&l(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function f(t){return f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},f(t)}function _(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,p(r.key),r)}}function p(t){var e=function(t,e){if("object"!=f(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=f(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==f(e)?e:String(e)}const y=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),"object"!==f(e)||null===e)throw new Error("Public data must be an object");Object.defineProperty(this,"hostname",{value:window.location.hostname,writable:!1}),Object.defineProperty(this,"port",{value:parseInt(window.location.port),writable:!1}),Object.defineProperty(this,"uuid",{value:s(),writable:!1}),this.connectionStatus=!1,this.public_data=e,this.init_websocket=!1,Object.defineProperty(this,"serverActions",{value:{INIT_USER:"init_user",UPDATE_USER_DATA:"update_user_data",GET_ALL_USERS:"get_all_users",RETURN_ALL_USERS:"return_all_users",USER_LEFT:"user_left",USER_ARRIVE:"user_arrive",SEND_MSG:"send_msg",MSG_ARRIVE:"msg_arrive",GET_PUBLIC_DATA_OF_USER:"get_public_data_of_user",RETURN_PUBLIC_DATA_OF_USER:"return_public_data_of_user"},writable:!1}),Object.defineProperty(this,"package_name",{value:(0,c.extractPluginUID)(window.location.pathname).replaceAll("-","."),writable:!1}),this.returnAllUsers=null,this.returnPublicDataOfUser=null}var e,n;return e=t,n=[{key:"init",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.websocket=new WebSocket("ws://".concat(this.hostname,":").concat(this.port+1)),this.websocket.addEventListener("open",(function(n){t.connectionStatus=!0,t.websocket.send(JSON.stringify({action:t.serverActions.INIT_USER,package_name:t.package_name,data:{uuid:t.uuid,public_data:t.public_data}})),null!=e&&e("open",n)})),this.websocket.addEventListener("error",(function(t){null!=e&&e("error",t)})),this.websocket.addEventListener("close",(function(n){t.connectionStatus=!1,null!=e&&e("close",n)})),this.websocket.addEventListener("message",(function(n){var r=n.data;if(r.length>0)switch((r=JSON.parse(r)).action){case t.serverActions.RETURN_ALL_USERS:null!=t.returnAllUsers&&t.returnAllUsers(r.all_users);break;case t.serverActions.USER_ARRIVE:null!=e&&e(t.serverActions.USER_ARRIVE,r.user);break;case t.serverActions.USER_LEFT:null!=e&&e(t.serverActions.USER_LEFT,r);break;case t.serverActions.MSG_ARRIVE:null!=e&&e(t.serverActions.MSG_ARRIVE,r.message);break;case t.serverActions.RETURN_PUBLIC_DATA_OF_USER:null!=t.returnPublicDataOfUser&&t.returnPublicDataOfUser(r.public_data);break;default:r.action.startsWith("db_action_")&&t.db_instance.websocket_handleDBAction(r)}})),this.init_websocket=!0}},{key:"createDBInstance",value:function(t,e){return this.db_instance=new d(t,this.websocket,e),this.db_instance}},{key:"sendMsg",value:function(t,e){if(!this.init_websocket)throw new Error("WebSocket not initialized");this.websocket.send(JSON.stringify({action:this.serverActions.SEND_MSG,data:{uuid:t,msg:e}}))}},{key:"getMyPublicData",value:function(){return this.public_data}},{key:"getMyUUID",value:function(){return this.uuid}},{key:"getAllUsers",value:function(t){if(!this.init_websocket)throw new Error("WebSocket not initialized");this.websocket.send(JSON.stringify({action:this.serverActions.GET_ALL_USERS})),this.returnAllUsers=t}},{key:"requestPublicData",value:function(t,e){if(!this.init_websocket)throw new Error("WebSocket not initialized");this.websocket.send(JSON.stringify({action:this.serverActions.GET_PUBLIC_DATA_OF_USER,data:{uuid:t}})),this.returnPublicDataOfUser=e}},{key:"updateMyPublicData",value:function(t){if("object"!==f(t)||null===t)throw new Error("Public data must be an object");this.public_data=t,this.websocket.send(JSON.stringify({action:this.serverActions.UPDATE_USER,data:{public_data:this.public_data}}))}}],n&&_(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}()})(),r})()));