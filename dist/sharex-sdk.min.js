!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("sharex-sdk",[],e):"object"==typeof exports?exports["sharex-sdk"]=e():t["sharex-sdk"]=e()}(self,(()=>(()=>{var t={853:t=>{function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e(t)}t.exports={extractPluginUID:function(t){var e=t.match(/\/SharexApp\/([\w-]+)(?:\/[^/]+)*\/?/i);return e?e[1]:""},convertToDotNotation:function t(n){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=[];for(var r in n)if(n.hasOwnProperty(r)){var a=o?"".concat(o,".").concat(r):r;"object"===e(n[r])&&null!==n[r]?i=i.concat(t(n[r],a)):i.push("".concat(a,":").concat(n[r]))}return i}}}},e={};function n(o){var i=e[o];if(void 0!==i)return i.exports;var r=e[o]={exports:{}};return t[o](r,r.exports,n),r.exports}n.d=(t,e)=>{for(var o in e)n.o(e,o)&&!n.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var o={};return(()=>{"use strict";n.r(o),n.d(o,{default:()=>y});const t={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let e;const i=new Uint8Array(16);function r(){if(!e&&(e="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!e))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return e(i)}const a=[];for(let t=0;t<256;++t)a.push((t+256).toString(16).slice(1));const s=function(e,n,o){if(t.randomUUID&&!n&&!e)return t.randomUUID();const i=(e=e||{}).random||(e.rng||r)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,n){o=o||0;for(let t=0;t<16;++t)n[o+t]=i[t];return n}return function(t,e=0){return a[t[e+0]]+a[t[e+1]]+a[t[e+2]]+a[t[e+3]]+"-"+a[t[e+4]]+a[t[e+5]]+"-"+a[t[e+6]]+a[t[e+7]]+"-"+a[t[e+8]]+a[t[e+9]]+"-"+a[t[e+10]]+a[t[e+11]]+a[t[e+12]]+a[t[e+13]]+a[t[e+14]]+a[t[e+15]]}(i)};var c=n(853);function u(t){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},u(t)}function l(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,d(o.key),o)}}function d(t){var e=function(t,e){if("object"!=u(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var o=n.call(t,"string");if("object"!=u(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==u(e)?e:String(e)}const b=function(){function t(e,n,o){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.db_name=e,this.websocket=n,this.db_callbacks=o,this.insert_data_callback=null,this.get_data_callback=null,this.update_data_callback=null,Object.defineProperty(this,"DBActions",{value:{INIT_DB:"init_user"},writable:!1}),this.websocket.send(JSON.stringify({action:"db_action_init_db",data:{db_name:this.db_name}})),Object.defineProperty(this,"dbActions",{value:{INIT_DB:"init_db",INIT_DB_RESULT:"init_db_result",INSERT_DATA:"insert_data",INSERT_DATA_BULK:"insert_data_bulk",INSERT_DATA_RESULT:"insert_data_result",GET_ALL_DATA:"get_all_data",GET_ALL_DATA_RESULT:"get_all_data_result",GET_DATA:"get_data",GET_DATA_RESULT:"get_data_result",UPDATE_DATA:"update_data",UPDATE_DATA_RESULT:"update_data_result"},writable:!1})}var e,n;return e=t,n=[{key:"websocket_handleDBAction",value:function(t){if(t.action=t.action.replace("db_action_",""),t.action==this.dbActions.INIT_DB_RESULT)this.db_callbacks(t.action,t.data);else if(t.action==this.dbActions.INSERT_DATA_RESULT)null!=this.insert_data_callback&&this.insert_data_callback(JSON.parse(t.data));else if(t.action==this.dbActions.GET_ALL_DATA_RESULT||t.action==this.dbActions.GET_DATA_RESULT){if(null!=this.get_data_callback)if(t.action==this.dbActions.GET_DATA_RESULT){var e=JSON.parse(t.data);this.get_data_callback({status:e.status,data:JSON.parse(e.data)})}else this.get_data_callback(JSON.parse(t.data))}else t.action==this.dbActions.UPDATE_DATA_RESULT&&null!=this.update_data_callback&&this.update_data_callback(JSON.parse(t.data))}},{key:"insert",value:function(t,e){var n,o,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=Array.isArray(e);if(!a&&"object"!==u(e)||a&&!Array.isArray(e))throw new Error(a?"data must be an array of objects":"data must be an object");if("string"!=typeof t)throw new Error("collection must be a string");if("function"==typeof i&&(r=i,i=null),null!==i&&"object"!==u(i))throw new Error("options must be an object");if(!0===(null===(n=i)||void 0===n?void 0:n.uuid))a?e.forEach((function(t,n){e[n]._uuid=s()})):e._uuid=s();else if(void 0!==(null===(o=i)||void 0===o?void 0:o.uuid))throw new Error("options.uuid must be a boolean");this.insert_data_callback=r;var c="db_action_".concat(a?this.dbActions.INSERT_DATA_BULK:this.dbActions.INSERT_DATA);this.websocket.send(JSON.stringify({action:c,data:{db_name:this.db_name,collection:t,new_data:e}}))}},{key:"find",value:function(t,e,n){if("function"==typeof e&&(n=e,e=null),"function"!=typeof n)throw new Error("callback must be a function");if("string"!=typeof t)throw new Error("collection must be a string");var o=null!==e&&"string"==typeof e;this.get_data_callback=n,o?this.websocket.send(JSON.stringify({action:"db_action_".concat(this.dbActions.GET_DATA),data:{db_name:this.db_name,collection:t,query:e}})):this.websocket.send(JSON.stringify({action:"db_action_".concat(this.dbActions.GET_ALL_DATA),data:{db_name:this.db_name,collection:t}}))}},{key:"update",value:function(t,e,n,o){if("function"!=typeof o)throw new Error("callback must be a function");if("string"!=typeof t)throw new Error("collection must be a string");if("string"!=typeof e)throw new Error("query must be a string");if("object"!==u(n))throw new Error("document must be an object");this.update_data_callback=o;var i=(0,c.convertToDotNotation)(n);console.log("Converted Notation: ",i),this.websocket.send(JSON.stringify({action:"db_action_".concat(this.dbActions.UPDATE_DATA),data:{db_name:this.db_name,collection:t,query:e,update:i}}))}}],n&&l(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function _(t){return _="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_(t)}function f(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,p(o.key),o)}}function p(t){var e=function(t,e){if("object"!=_(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var o=n.call(t,"string");if("object"!=_(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==_(e)?e:String(e)}const y=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),"object"!==_(e)||null===e)throw new Error("Public data must be an object");Object.defineProperty(this,"hostname",{value:window.location.hostname,writable:!1}),Object.defineProperty(this,"port",{value:parseInt(window.location.port),writable:!1}),Object.defineProperty(this,"uuid",{value:s(),writable:!1}),this.connectionStatus=!1,this.public_data=e,this.init_websocket=!1,Object.defineProperty(this,"serverActions",{value:{INIT_USER:"init_user",UPDATE_USER_DATA:"update_user_data",GET_ALL_USERS:"get_all_users",RETURN_ALL_USERS:"return_all_users",USER_LEFT:"user_left",USER_ARRIVE:"user_arrive",SEND_MSG:"send_msg",MSG_ARRIVE:"msg_arrive",GET_PUBLIC_DATA_OF_USER:"get_public_data_of_user",RETURN_PUBLIC_DATA_OF_USER:"return_public_data_of_user"},writable:!1}),Object.defineProperty(this,"package_name",{value:(0,c.extractPluginUID)(window.location.pathname).replaceAll("-","."),writable:!1}),this.returnAllUsers=null,this.returnPublicDataOfUser=null}var e,n;return e=t,n=[{key:"init",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.websocket=new WebSocket("ws://".concat(this.hostname,":").concat(this.port+1)),this.websocket.addEventListener("open",(function(n){t.connectionStatus=!0,t.websocket.send(JSON.stringify({action:t.serverActions.INIT_USER,package_name:t.package_name,data:{uuid:t.uuid,public_data:t.public_data}})),null!=e&&e("open",n)})),this.websocket.addEventListener("error",(function(t){null!=e&&e("error",t)})),this.websocket.addEventListener("close",(function(n){t.connectionStatus=!1,null!=e&&e("close",n)})),this.websocket.addEventListener("message",(function(n){var o=n.data;if(o.length>0)switch((o=JSON.parse(o)).action){case t.serverActions.RETURN_ALL_USERS:null!=t.returnAllUsers&&t.returnAllUsers(o.all_users);break;case t.serverActions.USER_ARRIVE:null!=e&&e(t.serverActions.USER_ARRIVE,o.user);break;case t.serverActions.USER_LEFT:null!=e&&e(t.serverActions.USER_LEFT,o);break;case t.serverActions.MSG_ARRIVE:null!=e&&e(t.serverActions.MSG_ARRIVE,o.message);break;case t.serverActions.RETURN_PUBLIC_DATA_OF_USER:null!=t.returnPublicDataOfUser&&t.returnPublicDataOfUser(o.public_data);break;default:o.action.startsWith("db_action_")&&t.db_instance.websocket_handleDBAction(o)}})),this.init_websocket=!0}},{key:"createDBInstance",value:function(t,e){return this.db_instance=new b(t,this.websocket,e),this.db_instance}},{key:"sendMsg",value:function(t,e){if(!this.init_websocket)throw new Error("WebSocket not initialized");this.websocket.send(JSON.stringify({action:this.serverActions.SEND_MSG,data:{uuid:t,msg:e}}))}},{key:"getMyPublicData",value:function(){return this.public_data}},{key:"getMyUUID",value:function(){return this.uuid}},{key:"getAllUsers",value:function(t){if(!this.init_websocket)throw new Error("WebSocket not initialized");this.websocket.send(JSON.stringify({action:this.serverActions.GET_ALL_USERS})),this.returnAllUsers=t}},{key:"requestPublicData",value:function(t,e){if(!this.init_websocket)throw new Error("WebSocket not initialized");this.websocket.send(JSON.stringify({action:this.serverActions.GET_PUBLIC_DATA_OF_USER,data:{uuid:t}})),this.returnPublicDataOfUser=e}},{key:"updateMyPublicData",value:function(t){if("object"!==_(t)||null===t)throw new Error("Public data must be an object");this.public_data=t,this.websocket.send(JSON.stringify({action:this.serverActions.UPDATE_USER,data:{public_data:this.public_data}}))}}],n&&f(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}()})(),o})()));