!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("sharex-sdk",[],t):"object"==typeof exports?exports["sharex-sdk"]=t():e["sharex-sdk"]=t()}(self,(()=>(()=>{var e={362:()=>{},853:e=>{e.exports={extractPluginUID:function(e){var t=e.match(/\/SharexApp\/([\w-]+)(?:\/[^/]+)*\/?/i);return t?t[1]:""}}}},t={};function r(n){var i=t[n];if(void 0!==i)return i.exports;var o=t[n]={exports:{}};return e[n](o,o.exports,r),o.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var n={};return(()=>{"use strict";r.r(n),r.d(n,{default:()=>_});const e={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let t;const i=new Uint8Array(16);function o(){if(!t&&(t="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!t))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return t(i)}const s=[];for(let e=0;e<256;++e)s.push((e+256).toString(16).slice(1));const a=function(t,r,n){if(e.randomUUID&&!r&&!t)return e.randomUUID();const i=(t=t||{}).random||(t.rng||o)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,r){n=n||0;for(let e=0;e<16;++e)r[n+e]=i[e];return r}return function(e,t=0){return s[e[t+0]]+s[e[t+1]]+s[e[t+2]]+s[e[t+3]]+"-"+s[e[t+4]]+s[e[t+5]]+"-"+s[e[t+6]]+s[e[t+7]]+"-"+s[e[t+8]]+s[e[t+9]]+"-"+s[e[t+10]]+s[e[t+11]]+s[e[t+12]]+s[e[t+13]]+s[e[t+14]]+s[e[t+15]]}(i)};var u=r(853),c=r(362),l=r.n(c);function d(e){return d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},d(e)}function b(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,f(n.key),n)}}function f(e){var t=function(e,t){if("object"!=d(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=d(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==d(t)?t:String(t)}const _=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),"object"!==d(t)||null===t)throw new Error("Public data must be an object");Object.defineProperty(this,"hostname",{value:window.location.hostname,writable:!1}),Object.defineProperty(this,"port",{value:parseInt(window.location.port),writable:!1}),Object.defineProperty(this,"uuid",{value:a(),writable:!1}),this.connectionStatus=!1,this.public_data=t,this.init_websocket=!1,Object.defineProperty(this,"serverActions",{value:{INIT_USER:"init_user",UPDATE_USER_DATA:"update_user_data",GET_ALL_USERS:"get_all_users",RETURN_ALL_USERS:"return_all_users",USER_LEFT:"user_left",USER_ARRIVE:"user_arrive",SEND_MSG:"send_msg",MSG_ARRIVE:"msg_arrive",GET_PUBLIC_DATA_OF_USER:"get_public_data_of_user",RETURN_PUBLIC_DATA_OF_USER:"return_public_data_of_user"},writable:!1}),Object.defineProperty(this,"package_name",{value:(0,u.extractPluginUID)(window.location.pathname).replaceAll("-","."),writable:!1}),this.returnAllUsers=null,this.returnPublicDataOfUser=null}var t,r;return t=e,r=[{key:"init",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.websocket=new WebSocket("ws://".concat(this.hostname,":").concat(this.port+1)),this.websocket.addEventListener("open",(function(r){e.connectionStatus=!0,e.websocket.send(JSON.stringify({action:e.serverActions.INIT_USER,package_name:e.package_name,data:{uuid:e.uuid,public_data:e.public_data}})),null!=t&&t("open",r)})),this.websocket.addEventListener("error",(function(e){null!=t&&t("error",e)})),this.websocket.addEventListener("close",(function(r){e.connectionStatus=!1,null!=t&&t("close",r)})),this.websocket.addEventListener("message",(function(r){var n=r.data;if(n.length>0)switch((n=JSON.parse(n)).action){case e.serverActions.RETURN_ALL_USERS:null!=e.returnAllUsers&&e.returnAllUsers(n.all_users);break;case e.serverActions.USER_ARRIVE:null!=t&&t(e.serverActions.USER_ARRIVE,n.user);break;case e.serverActions.USER_LEFT:null!=t&&t(e.serverActions.USER_LEFT,n);break;case e.serverActions.MSG_ARRIVE:null!=t&&t(e.serverActions.MSG_ARRIVE,n.message);break;case e.serverActions.RETURN_PUBLIC_DATA_OF_USER:null!=e.returnPublicDataOfUser&&e.returnPublicDataOfUser(n.public_data);break;default:n.action.startsWith("db_action_")&&e.db_instance.websocket_handleDBAction(n)}})),this.init_websocket=!0}},{key:"createDBInstance",value:function(e,t){return this.db_instance=new(l())(e,this.websocket,t),this.db_instance}},{key:"sendMsg",value:function(e,t){if(!this.init_websocket)throw new Error("WebSocket not initialized");this.websocket.send(JSON.stringify({action:this.serverActions.SEND_MSG,data:{uuid:e,msg:t}}))}},{key:"getMyPublicData",value:function(){return this.public_data}},{key:"getMyUUID",value:function(){return this.uuid}},{key:"getAllUsers",value:function(e){if(!this.init_websocket)throw new Error("WebSocket not initialized");this.websocket.send(JSON.stringify({action:this.serverActions.GET_ALL_USERS})),this.returnAllUsers=e}},{key:"requestPublicData",value:function(e,t){if(!this.init_websocket)throw new Error("WebSocket not initialized");this.websocket.send(JSON.stringify({action:this.serverActions.GET_PUBLIC_DATA_OF_USER,data:{uuid:e}})),this.returnPublicDataOfUser=t}},{key:"updateMyPublicData",value:function(e){if("object"!==d(e)||null===e)throw new Error("Public data must be an object");this.public_data=e,this.websocket.send(JSON.stringify({action:this.serverActions.UPDATE_USER,data:{public_data:this.public_data}}))}}],r&&b(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}()})(),n})()));